name: Automate Preprocessing Pipeline

on:
  push:
    branches: [ "main" ]
    paths:
      - 'preprocessing/**.py'
      - '*.csv'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  run-preprocessing:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
        
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy scikit-learn

      - name: Run Preprocessing Script
        run: |
          python "preprocessing/automate_Reditya Imanuel Yuwono-siswa.py" --input "german_credit_data_dataset_.csv" --output "preprocessing/german_credit_preprocessing.csv"

      - name: Commit and Push Clean Data
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ðŸ¤– Auto-generated: Update clean data in preprocessing folder"
          file_pattern: "preprocessing/*.csv"